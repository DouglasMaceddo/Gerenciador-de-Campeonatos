<div class="eliminatoria-container">
  <button class="acao-btn voltar" (click)="voltar()">â¬… Voltar</button>

  <ng-container *ngIf="camp; else notFound">

    <!-- INFO -->
    <section class="info-camp">
      <h2>{{ camp.nome }}</h2>
      <p><strong>DescriÃ§Ã£o:</strong> {{ camp.descricao }}</p>
      <p><strong>Formato:</strong> {{ camp.formato }}</p>
      <p><strong>Times:</strong> {{ camp.numTimes }}</p>
      <button [disabled]="camp.fase == 'grupos' " (click)="gerarFaseDeGrupos()"> Gerar Confrontos</button>
    </section>

    <!-- GRID -->
    <section class="grid-principal">

      <!-- CONFRONTOS -->
      <div class="card">
        <h3>Confrontos</h3>

        <!-- FASE DE GRUPOS -->
        <section
          *ngIf="camp.fase === 'grupos' || camp.fase === 'quartas' || camp.fase === 'semis' || camp.fase === 'final'">
          <h4>Fase de Grupos</h4>

          <table class="tabela">
            <tr *ngFor="let c of camp.confrontos">
              <td>{{ c.timeA.nome }}</td>

              <td class="placar">
                <input type="number" min="0" [(ngModel)]="c.golsA" [disabled]="''" (change)="onPlacarChange(c)">
                x
                <input type="number" min="0" [(ngModel)]="c.golsB" [disabled]="''" (change)="onPlacarChange(c)">
              </td>

              <td>{{ c.timeB.nome }}</td>
              <td>
                <button [disabled]="camp.fase !== 'grupos'" class="evento-btn" (click)="abrirEventos(c)">
                  âš½ Eventos
                </button>
              </td>
            </tr>
          </table>

          <button class="acao-btn" *ngIf="camp.fase === 'grupos'" (click)="finalizarFaseDeGrupos()">
            Encerrar Fase de Grupos
          </button>
        </section>

        <!-- QUARTAS -->
        <section *ngIf="camp.fase === 'quartas'">
          <h4>QUARTAS DE FINAL</h4>

          <table class="tabela">
            <ng-container *ngFor="let q of quartas">

              <!-- JOGO -->
              <tr>
                <td>{{ q.timeA.nome }}</td>

                <td class="placar">
                  <input type="number" min="0" [(ngModel)]="q.golsA" [disabled]="camp.fase !== 'quartas'">
                  x
                  <input type="number" min="0" [(ngModel)]="q.golsB" [disabled]="camp.fase !== 'quartas'">
                </td>

                <td>{{ q.timeB.nome }}</td>

                <td>
                  <button class="evento-btn" [disabled]="camp.fase !== 'quartas'" (click)="abrirEventos(q)">
                    âš½ Eventos
                  </button>
                </td>
              </tr>

              <!-- PENALIDADES -->
              <tr *ngIf="q.golsA !== null && q.golsA === q.golsB">
                <td colspan="4" class="penaltis">
                  ðŸ¥… PÃªnaltis:
                  <input type="number" min="0" [(ngModel)]="q.penaltisA">
                  x
                  <input type="number" min="0" [(ngModel)]="q.penaltisB">
                </td>
              </tr>

            </ng-container>
          </table>

          <button class="acao-btn" *ngIf="camp.fase === 'quartas'" (click)="atualizarPlacar(null, 'quartas')">
            Finalizar Quartas de Final
          </button>
        </section>

        <!-- SEMIS -->
        <section
          *ngIf="camp.fase === 'grupos' || camp.fase === 'quartas' || camp.fase === 'semis' || camp.fase === 'final'">
          <h4>SEMI FINAL</h4>

          <table class="tabela">
            <ng-container *ngFor="let s of semis">

              <!-- JOGO -->
              <tr>
                <td>{{ s.timeA.nome }}</td>

                <td class="placar">
                  <input type="number" min="0" [(ngModel)]="s.golsA" [disabled]="''">
                  x
                  <input type="number" min="0" [(ngModel)]="s.golsB" [disabled]="''">
                </td>

                <td>{{ s.timeB.nome }}</td>

                <td>
                  <button class="evento-btn" [disabled]="camp.fase !== 'semis'" (click)="abrirEventos(s)">
                    âš½ Eventos
                  </button>
                </td>
              </tr>

              <!-- PENALIDADES -->
              <tr *ngIf="s.golsA !== null && s.golsA === s.golsB">
                <td colspan="4" class="penaltis">
                  ðŸ¥… PÃªnaltis:
              <tr class="placar">
                <input type="number" min="0" [(ngModel)]="s.penaltisA" [disabled]="camp.fase !== 'semis'">
                x
                <input type="number" min="0" [(ngModel)]="s.penaltisB" [disabled]="camp.fase !== 'semis'">
              </tr>
              </td>
              </tr>

            </ng-container>
          </table>
          <button class="acao-btn" *ngIf="camp.fase === 'semis'" (click)="atualizarPlacar(null, 'semis')">
            Finalizar Semi Final
          </button>
        </section>

        <!-- FINAL -->
        <section *ngIf="camp.fase === 'final'">
          <h4>FINAL</h4>

          <table class="tabela">
            <ng-container *ngFor="let f of final">

              <!-- JOGO -->
              <tr>
                <td>{{ f.timeA.nome }}</td>

                <td class="placar">
                  <input type="number" min="0" [(ngModel)]="f.golsA" [disabled]="''">
                  x
                  <input type="number" min="0" [(ngModel)]="f.golsB" [disabled]="''">
                </td>

                <td>{{ f.timeB.nome }}</td>

                <td>
                  <button class="evento-btn" [disabled]="camp.fase !== 'final'" (click)="abrirEventos(f)">
                    âš½ Eventos
                  </button>
                </td>
              </tr>

              <!-- PENALIDADES -->
              <tr *ngIf="f.golsA !== null && f.golsA === f.golsB">
                <td colspan="4" class="penaltis">
                  ðŸ¥… PÃªnaltis:
              <tr class="placar">
                <input type="number" min="0" [(ngModel)]="f.penaltisA" [disabled]="camp.fase !== 'final'">
                x
                <input type="number" min="0" [(ngModel)]="f.penaltisB" [disabled]="camp.fase !== 'final'">
              </tr>
              </td>
              </tr>

            </ng-container>
          </table>

          <button class="acao-btn" *ngIf="camp.fase === 'final'" (click)="atualizarPlacar(null, 'final')">
            Finalizar Final
          </button>
        </section>
      </div>

      <!-- CLASSIFICAÃ‡ÃƒO -->
      <div class="card">
        <h3>ClassificaÃ§Ã£o</h3>

        <table class="tabela">
          <thead>
            <tr>
              <th>#</th>
              <th>Time</th>
              <th>P</th>
              <th>J</th>
              <th>V</th>
              <th>E</th>
              <th>D</th>
              <th>GP</th>
              <th>GC</th>
              <th>SG</th>
            </tr>
          </thead>
          <tr *ngFor="let c of classificacao; index as i">
            <td>{{ i + 1 }}</td>
            <td>{{ c.nome }}</td>
            <td>{{ c.pontos }}</td>
            <td>{{ c.jogos }}</td>
            <td>{{ c.vitorias }}</td>
            <td>{{ c.empates }}</td>
            <td>{{ c.derrotas }}</td>
            <td>{{ c.golsPro }}</td>
            <td>{{ c.golsContra }}</td>
            <td>{{ c.saldo }}</td>
          </tr>
        </table>
      </div>

      <!-- ARTILHARIA -->
      <div class="card">
        <h3>Artilharia</h3>

        <table class="tabela">
          <thead>
            <tr>
              <th>Jogador</th>
              <th>Time</th>
              <th>Gols</th>
            </tr>
          </thead>
          <tr *ngFor="let a of artilheiros">
            <td>{{ a.nome }}</td>
            <td>{{ a.time }}</td>
            <td>{{ a.gols }}</td>
          </tr>
        </table>
        <div>
          <h3>CartÃµes</h3>

          <table class="tabela">
            <thead>
              <tr>
                <th>Jogador</th>
                <th>CartÃ£o Amarelo</th>
                <th>CartÃ£o Vermelho</th>
              </tr>
            </thead>
            <tr *ngFor="let j of artilheiros">
              <td>{{ j.nome }}</td>
              <td>{{ j.amarelo }}</td>
              <td>{{ j.vermelho }}</td>
            </tr>
          </table>
        </div>
      </div>

    </section>

    <p *ngIf="mensagem" class="mensagem">{{ mensagem }}</p>

  </ng-container>

  <ng-template #notFound>
    <p class="info-vazia">Campeonato nÃ£o encontrado.</p>
  </ng-template>

  <div class="modal-backdrop" *ngIf="modalAberto">
    <div class="modal">
      <h3>
        Eventos - {{ confrontoSelecionado?.timeA?.nome }}
        x
        {{ confrontoSelecionado?.timeB?.nome }}
      </h3>

      <select [(ngModel)]="eventoJogadorId">
        <option value="">Selecione o jogador</option>

        <!-- TIME A -->
        <ng-container *ngIf="confrontoSelecionado?.timeA">
          <option disabled>
            â€” {{ confrontoSelecionado?.timeA?.nome }} â€”
          </option>


          <option *ngFor="let j of confrontoSelecionado?.timeA?.jogadores || []" [value]="j.id">
            {{ j.nome }}
          </option>
        </ng-container>

        <!-- TIME B -->
        <ng-container *ngIf="confrontoSelecionado?.timeB">
          <option disabled>
            â€” {{ confrontoSelecionado?.timeB?.nome }} â€”
          </option>

          <option *ngFor="let j of confrontoSelecionado?.timeB?.jogadores || []" [value]="j.id">
            {{ j.nome }}
          </option>
        </ng-container>
      </select>


      <select [(ngModel)]="eventoTipo">
        <option value="gol">âš½ Gol</option>
        <option value="amarelo">ðŸŸ¨ Amarelo</option>
        <option value="vermelho">ðŸŸ¥ Vermelho</option>
      </select>

      <div class="modal-acoes">
        <button class="acao-btn" (click)="registrarEvento()">Salvar</button>
        <button class="fechar" (click)="fecharModal()">Cancelar</button>
      </div>
    </div>
  </div>

</div>